serviceMaps:
  serviceName: property-services
  mappings:
  - version: 1.0
    description: Persists property details in EG_PT_PROPERTY  table
    fromTopic: save-property-registry
    isTransaction: true
    queryMaps:


    - query: INSERT INTO eg_pt_property_audit (audituuid, propertyid, property, auditcreatedtime) VALUES ((select nextval('seq_eg_pt_registry_audit')), ?, ?, (SELECT extract(epoch from now())));
      basePath: Property
      jsonMaps:

      - jsonPath: $.Property.propertyId

      - jsonPath: $.Property
        type: JSON
        dbType: JSONB

    - query: INSERT INTO eg_pt_property (id, propertyid, tenantid, surveyid, accountid, oldpropertyid, status, acknowldgementnumber, propertytype, ownershipcategory, usagecategory, creationreason, nooffloors, landarea, superbuiltuparea, linkedproperties, source,  channel, createdby, createdtime, lastmodifiedby, lastmodifiedtime, additionaldetails,exemption) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,?);
      basePath: Property
      jsonMaps:

      - jsonPath: $.Property.id

      - jsonPath: $.Property.propertyId

      - jsonPath: $.Property.tenantId

      - jsonPath: $.Property.surveyId

      - jsonPath: $.Property.accountId

      - jsonPath: $.Property.oldPropertyId

      - jsonPath: $.Property.status

      - jsonPath: $.Property.acknowldgementNumber

      - jsonPath: $.Property.propertyType

      - jsonPath: $.Property.ownershipCategory

      - jsonPath: $.Property.usageCategory

      - jsonPath: $.Property.creationReason

      - jsonPath: $.Property.noOfFloors

      - jsonPath: $.Property.landArea

      - jsonPath: $.Property.superBuiltUpArea

      - jsonPath: $.Property.linkedProperties
        type: ARRAY
        dbType: STRING

      - jsonPath: $.Property.source

      - jsonPath: $.Property.channel

      - jsonPath: $.Property.auditDetails.createdBy

      - jsonPath: $.Property.auditDetails.createdTime

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.lastModifiedTime

      - jsonPath: $.Property.additionalDetails
        type: JSON
        dbType: JSONB

      - jsonPath: $.Property.exemption


    - query: INSERT INTO eg_pt_owner(ownerinfouuid, tenantid, propertyid, userid, status, isprimaryowner, ownertype, ownershippercentage, institutionid, relationship, createdby, createdtime, lastmodifiedby, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
      basePath: Property.owners.*
      jsonMaps:

      - jsonPath: $.Property.*.ownerInfoUuid

      - jsonPath: $.Property.tenantId

      - jsonPath: $.Property.id

      - jsonPath: $.Property.owners.*.uuid

      - jsonPath: $.Property.owners.*.status

      - jsonPath: $.Property.owners.*.isPrimaryOwner

      - jsonPath: $.Property.owners.*.ownerType

      - jsonPath: $.Property.owners.*.ownerShipPercentage

      - jsonPath: $.Property.owners.*.institutionId

      - jsonPath: $.Property.owners.*.relationship

      - jsonPath: $.Property.auditDetails.createdBy

      - jsonPath: $.Property.auditDetails.createdTime

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.lastModifiedTime


    - query: INSERT INTO eg_pt_document (id, tenantid, entityid, documenttype, filestoreid, documentuid, status, createdby, lastmodifiedby, createdtime, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
      basePath: $.Property.documents.*
      jsonMaps:

      - jsonPath: $.Property.documents.*.id

      - jsonPath: $.Property.tenantId

      - jsonPath: $.Property.id

      - jsonPath: $.Property.documents.*.documentType

      - jsonPath: $.Property.documents.*.fileStoreId

      - jsonPath: $.Property.documents.*.documentUid

      - jsonPath: $.Property.documents.*.status

      - jsonPath: $.Property.auditDetails.createdBy

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.createdTime

      - jsonPath: $.Property.auditDetails.lastModifiedTime


    - query: INSERT INTO eg_pt_document (id, tenantid, entityid, documenttype, filestoreid, documentuid, status, createdby, lastmodifiedby, createdtime, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
      basePath: $.Property.owners.*.documents.*
      jsonMaps:

      - jsonPath: $.Property.owners.*.documents.*.id

      - jsonPath: $.Property.tenantId

      - jsonPath: $.Property.owners[*][?({id} in @.documents[*].id)].ownerInfoUuid

      - jsonPath: $.Property.owners.*.documents.*.documentType

      - jsonPath: $.Property.owners.*.documents.*.fileStoreId

      - jsonPath: $.Property.owners.*.documents.*.documentUid

      - jsonPath: $.Property.documents.*.status

      - jsonPath: $.Property.auditDetails.createdBy

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.createdTime

      - jsonPath: $.Property.auditDetails.lastModifiedTime


    - query: INSERT INTO eg_pt_institution (id, propertyid, tenantid, name, nameofauthorizedperson, type, designation, createdby, createdtime, lastmodifiedby, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);
      basePath: $.Property.institution
      jsonMaps:

      - jsonPath: $.Property.institution.id

      - jsonPath: $.Property.id

      - jsonPath: $.Property.tenantId

      - jsonPath: $.Property.institution.name

      - jsonPath: $.Property.institution.nameOfAuthorizedPerson

      - jsonPath: $.Property.institution.type

      - jsonPath: $.Property.institution.designation

      - jsonPath: $.Property.auditDetails.createdBy

      - jsonPath: $.Property.auditDetails.createdTime

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.lastModifiedTime


    - query: INSERT INTO eg_pt_address(tenantid, id, propertyid, doorno, plotno, buildingname, street, landmark, city, pincode, locality, district, region, state, country, latitude, longitude, createdby, createdtime, lastmodifiedby, lastmodifiedtime, additionaldetails,dag_no,district_name,town_name,ward_no,village,patta_no,proper_house_no,common_name_of_building,principal_road_name,sub_side_road_name,landmark_name,others,type_of_road) VALUES (?, ?,?,?,?,?,?,?,?,?,?,?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,?,?);
      basePath: Property.address
      jsonMaps:

      - jsonPath: $.Property.tenantId

      - jsonPath: $.Property.address.id

      - jsonPath: $.Property.id

      - jsonPath: $.Property.address.doorNo

      - jsonPath: $.Property.address.plotNo

      - jsonPath: $.Property.address.buildingName

      - jsonPath: $.Property.address.street

      - jsonPath: $.Property.address.landmark

      - jsonPath: $.Property.address.city

      - jsonPath: $.Property.address.pincode

      - jsonPath: $.Property.address.locality.code

      - jsonPath: $.Property.address.district

      - jsonPath: $.Property.address.region

      - jsonPath: $.Property.address.state

      - jsonPath: $.Property.address.country

      - jsonPath: $.Property.address.geoLocation.latitude

      - jsonPath: $.Property.address.geoLocation.longitude

      - jsonPath: $.Property.auditDetails.createdBy

      - jsonPath: $.Property.auditDetails.createdTime

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.lastModifiedTime

      - jsonPath: $.Property.address.additionalDetails
        type: JSON
        dbType: JSONB
      
      - jsonPath: $.Property.address.dagNo
      
      - jsonPath: $.Property.address.districtName
      
      - jsonPath: $.Property.address.townName
      
      - jsonPath: $.Property.address.wardNo
      
      - jsonPath: $.Property.address.village
      
      - jsonPath: $.Property.address.pattaNo
      
      - jsonPath: $.Property.address.properHouseNo
      
      - jsonPath: $.Property.address.commonNameOfBuilding
      
      - jsonPath: $.Property.address.principalRoadName
      
      - jsonPath: $.Property.address.subSideRoadName
      
      - jsonPath: $.Property.address.landmarkName
      
      - jsonPath: $.Property.address.others

      - jsonPath: $.Property.address.typeOfRoad.code
        


    - query: INSERT INTO eg_pt_unit(id, tenantid, propertyid, floorno, unittype, usagecategory, occupancytype, occupancydate, carpetarea, builtuparea, plintharea, superbuiltuparea, arv, constructiontype, constructiondate, dimensions, active, createdby, createdtime, lastmodifiedby, lastmodifiedtime,structuretype,ageofproperty) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?,?,?);
      basePath: Property.units.*
      jsonMaps:

      - jsonPath: $.Property.units.*.id

      - jsonPath: $.Property.tenantId

      - jsonPath: $.Property.id

      - jsonPath: $.Property.units.*.floorNo

      - jsonPath: $.Property.units.*.unitType

      - jsonPath: $.Property.units.*.usageCategory

      - jsonPath: $.Property.units.*.occupancyType

      - jsonPath: $.Property.units.*.occupancyDate

      - jsonPath: $.Property.units.*.constructionDetail.carpetArea

      - jsonPath: $.Property.units.*.constructionDetail.builtUpArea

      - jsonPath: $.Property.units.*.constructionDetail.plinthArea

      - jsonPath: $.Property.units.*.constructionDetail.superBuiltUpArea

      - jsonPath: $.Property.units.*.arv

      - jsonPath: $.Property.units.*.constructionDetail.constructionType

      - jsonPath: $.Property.units.*.constructionDetail.constructionDate

      - jsonPath: $.Property.units.*.constructionDetail.dimensions
        type: JSON
        dbType: JSONB

      - jsonPath: $.Property.units.*.active

      - jsonPath: $.Property.auditDetails.createdBy

      - jsonPath: $.Property.auditDetails.createdTime

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.lastModifiedTime

      - jsonPath: $.Property.units.*.structureType

      - jsonPath: $.Property.units.*.ageOfProperty

  - version: 1.0
    description: Update property EG_PT_PROPERTY ltable
    fromTopic: update-property-registry
    isTransaction: true
    queryMaps:


    - query: INSERT INTO eg_pt_property_audit (audituuid, propertyid, property, auditcreatedtime) VALUES ((select nextval('seq_eg_pt_registry_audit')), ?, ?, (SELECT extract(epoch from now())));
      basePath: Property
      jsonMaps:

      - jsonPath: $.Property.propertyId

      - jsonPath: $.Property
        type: JSON
        dbType: JSONB

    - query: UPDATE eg_pt_property SET propertyid=?,  surveyid=?, accountid=?, oldpropertyid=?, status=?, propertytype=?, ownershipcategory=?, usagecategory=?, nooffloors=?, landarea=?,   superbuiltuparea=?, linkedproperties=?, lastmodifiedby=?, lastmodifiedtime=?, additionaldetails=? WHERE Id=? AND tenantId=?;
      basePath: Property
      jsonMaps:

      - jsonPath: $.Property.propertyId

      - jsonPath: $.Property.surveyId

      - jsonPath: $.Property.accountId

      - jsonPath: $.Property.oldPropertyId

      - jsonPath: $.Property.status

      - jsonPath: $.Property.propertyType

      - jsonPath: $.Property.ownershipCategory

      - jsonPath: $.Property.usageCategory

      - jsonPath: $.Property.noOfFloors

      - jsonPath: $.Property.landArea

      - jsonPath: $.Property.superBuiltUpArea

      - jsonPath: $.Property.linkedProperties

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.lastModifiedTime

      - jsonPath: $.Property.additionalDetails
        type: JSON
        dbType: JSONB

      - jsonPath: $.Property.id

      - jsonPath: $.Property.tenantId



    - query: INSERT INTO eg_pt_owner (ownerinfouuid, tenantid, propertyid, userid, status, isprimaryowner, ownertype, ownershippercentage, institutionid, relationship, createdby, createdtime, lastmodifiedby, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON CONFLICT (userid, propertyid) DO UPDATE SET status=EXCLUDED.status, isprimaryowner=EXCLUDED.isprimaryowner, ownertype=EXCLUDED.ownertype, ownershippercentage=EXCLUDED.ownershippercentage, institutionid=EXCLUDED.institutionid, relationship=EXCLUDED.relationship, lastmodifiedby=EXCLUDED.lastModifiedby, lastmodifiedtime=EXCLUDED.lastmodifiedtime;
      basePath: Property.owners.*
      jsonMaps:

      - jsonPath: $.Property.*.ownerInfoUuid

      - jsonPath: $.Property.tenantId

      - jsonPath: $.Property.id

      - jsonPath: $.Property.owners.*.uuid

      - jsonPath: $.Property.owners.*.status

      - jsonPath: $.Property.owners.*.isPrimaryOwner

      - jsonPath: $.Property.owners.*.ownerType

      - jsonPath: $.Property.owners.*.ownerShipPercentage

      - jsonPath: $.Property.owners.*.institutionId

      - jsonPath: $.Property.owners.*.relationship

      - jsonPath: $.Property.auditDetails.createdBy

      - jsonPath: $.Property.auditDetails.createdTime

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.lastModifiedTime

    - query: INSERT INTO eg_pt_document (id, tenantid, entityid, documenttype, filestoreid, documentuid, status, createdby, lastmodifiedby, createdtime, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON CONFLICT (id) DO UPDATE SET documenttype = EXCLUDED.documenttype,fileStoreid = EXCLUDED.filestoreid, documentuid=EXCLUDED.documentuid, status=EXCLUDED.status, lastmodifiedby = EXCLUDED.lastModifiedby, lastmodifiedtime = EXCLUDED.lastmodifiedtime;
      basePath: $.Property.documents.*
      jsonMaps:

      - jsonPath: $.Property.documents.*.id

      - jsonPath: $.Property.tenantId

      - jsonPath: $.Property.id

      - jsonPath: $.Property.documents.*.documentType

      - jsonPath: $.Property.documents.*.fileStoreId

      - jsonPath: $.Property.documents.*.documentUid

      - jsonPath: $.Property.documents.*.status

      - jsonPath: $.Property.auditDetails.createdBy

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.createdTime

      - jsonPath: $.Property.auditDetails.lastModifiedTime

    - query: INSERT INTO eg_pt_document (id, tenantid, entityid, documenttype, filestoreid, documentuid, status, createdby, lastmodifiedby, createdtime, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON CONFLICT (id) DO UPDATE SET documenttype = EXCLUDED.documenttype,fileStoreid = EXCLUDED.filestoreid, documentuid=EXCLUDED.documentuid, status=EXCLUDED.status, lastmodifiedby = EXCLUDED.lastModifiedby, lastmodifiedtime = EXCLUDED.lastmodifiedtime;
      basePath: $.Property.owners.*.documents.*
      jsonMaps:

      - jsonPath: $.Property.owners.*.documents.*.id

      - jsonPath: $.Property.tenantId

      - jsonPath: $.Property.owners[*][?({id} in @.documents[*].id)].ownerInfoUuid

      - jsonPath: $.Property.owners.*.documents.*.documentType

      - jsonPath: $.Property.owners.*.documents.*.fileStoreId

      - jsonPath: $.Property.owners.*.documents.*.documentUid

      - jsonPath: $.Property.owners.*.documents.*.status

      - jsonPath: $.Property.auditDetails.createdBy

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.createdTime

      - jsonPath: $.Property.auditDetails.lastModifiedTime

    - query: UPDATE eg_pt_address SET doorno=?, plotno=?, buildingname=?, street=?, landmark=?, city=?, pincode=?, locality=?, district=?, region=?, state=?, country=?, latitude=?, longitude=?, lastmodifiedby=?, lastmodifiedtime=?, additionaldetails=? WHERE id=?;
      basePath: Property.address
      jsonMaps:

      - jsonPath: $.Property.address.doorNo

      - jsonPath: $.Property.address.plotNo

      - jsonPath: $.Property.address.buildingName

      - jsonPath: $.Property.address.street

      - jsonPath: $.Property.address.landmark

      - jsonPath: $.Property.address.city

      - jsonPath: $.Property.address.pincode

      - jsonPath: $.Property.address.locality.code

      - jsonPath: $.Property.address.district

      - jsonPath: $.Property.address.region

      - jsonPath: $.Property.address.state

      - jsonPath: $.Property.address.country

      - jsonPath: $.Property.address.geoLocation.latitude

      - jsonPath: $.Property.address.geoLocation.longitude

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.lastModifiedTime

      - jsonPath: $.Property.address.additionalDetails
        type: JSON
        dbType: JSONB

      - jsonPath: $.Property.address.id

    - query: INSERT INTO eg_pt_institution (id, propertyid, tenantid, name, nameofauthorizedperson, type, designation, createdby, createdtime, lastmodifiedby, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON CONFLICT (id) DO UPDATE SET name=EXCLUDED.name, type=EXCLUDED.type, designation=EXCLUDED.designation, lastmodifiedby=EXCLUDED.lastModifiedby, lastmodifiedtime=EXCLUDED.lastmodifiedtime;
      basePath: $.Property.institution
      jsonMaps:

      - jsonPath: $.Property.institution.id

      - jsonPath: $.Property.id

      - jsonPath: $.Property.tenantId

      - jsonPath: $.Property.institution.name

      - jsonPath: $.Property.institution.nameOfAuthorizedPerson

      - jsonPath: $.Property.institution.type

      - jsonPath: $.Property.institution.designation

      - jsonPath: $.Property.auditDetails.createdBy

      - jsonPath: $.Property.auditDetails.createdTime

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.lastModifiedTime


    - query: UPDATE eg_pt_unit SET floorno=?, unittype=?, usagecategory=?, occupancytype=?, occupancydate=?, carpetarea=?, builtuparea=?, plintharea=?, superbuiltuparea=?, arv=?, constructiontype=?, constructiondate=?, dimensions=?, active=?, lastmodifiedby=?, lastmodifiedtime=? WHERE id=?;
      basePath: Property.units.*
      jsonMaps:

      - jsonPath: $.Property.units.*.floorNo

      - jsonPath: $.Property.units.*.unitType

      - jsonPath: $.Property.units.*.usageCategory

      - jsonPath: $.Property.units.*.occupancyType

      - jsonPath: $.Property.units.*.occupancyDate

      - jsonPath: $.Property.units.*.constructionDetail.carpetArea

      - jsonPath: $.Property.units.*.constructionDetail.builtUpArea

      - jsonPath: $.Property.units.*.constructionDetail.plinthArea

      - jsonPath: $.Property.units.*.constructionDetail.superBuiltUpArea

      - jsonPath: $.Property.units.*.arv

      - jsonPath: $.Property.units.*.constructionDetail.constructionType

      - jsonPath: $.Property.units.*.constructionDetail.constructionDate

      - jsonPath: $.Property.units.*.constructionDetail.dimensions
        type: JSON
        dbType: JSONB

      - jsonPath: $.Property.units.*.active

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.lastModifiedTime

      - jsonPath: $.Property.units.*.id

    


  - version: 1.0
    description: Update documents in  EG_PT_PROPERTY ltable
    fromTopic: update-property-doc-registry
    isTransaction: true
    queryMaps:


    - query: INSERT INTO eg_pt_document (id, tenantid, entityid, documenttype, filestoreid, documentuid, status, createdby, lastmodifiedby, createdtime, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?) ON CONFLICT (id) DO UPDATE SET documenttype = EXCLUDED.documenttype,fileStoreid = EXCLUDED.filestoreid, documentuid=EXCLUDED.documentuid, status=EXCLUDED.status, lastmodifiedby = EXCLUDED.lastModifiedby, lastmodifiedtime = EXCLUDED.lastmodifiedtime;
      basePath: $.Property.documents.*
      jsonMaps:

      - jsonPath: $.Property.documents.*.id

      - jsonPath: $.Property.tenantId

      - jsonPath: $.Property.id

      - jsonPath: $.Property.documents.*.documentType

      - jsonPath: $.Property.documents.*.fileStoreId

      - jsonPath: $.Property.documents.*.documentUid

      - jsonPath: $.Property.documents.*.status

      - jsonPath: $.Property.auditDetails.createdBy

      - jsonPath: $.Property.auditDetails.lastModifiedBy

      - jsonPath: $.Property.auditDetails.createdTime

      - jsonPath: $.Property.auditDetails.lastModifiedTime

  
  
  - version: 1.0
    description: Update  in  EG_PT_PROPERTY table in case of amalgamation
    fromTopic: update-property-amalgamation
    isTransaction: true
    queryMaps:


    - query: UPDATE eg_pt_property SET  status='INACTIVE' WHERE Id=? AND tenantId=?;
      basePath: $.Property.amalgamatedProperty.*
      jsonMaps:

      - jsonPath: $.Property.amalgamatedProperty[*].property.id

      - jsonPath: $.Property.amalgamatedProperty[*].property.tenantId
